(wx.webpackJsonp=wx.webpackJsonp||[]).push([[20],{"136":function(e,t,n){"use strict";n.r(t);n(137);var o=n(52);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r)},"137":function(e,t,n){"use strict";n(75)},"138":function(e,t,n){},"139":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0}),t.orderPay=function orderPay(e){return(0,o.default)("/wx/charge/order",e)};var o=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(5))},"27":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var B=_interopRequireDefault(n(3)),U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},W=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],o=!0,r=!1,u=void 0;try{for(var i,a=e[Symbol.iterator]();!(o=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,u=e}finally{try{!o&&a.return&&a.return()}finally{if(r)throw u}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,u,H=n(0),K=_interopRequireDefault(H);n(138);var Q=function _interopRequireWildcard(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(n(139)),X=n(7);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(r,u){return function step(e,t){try{var n=i[e](t),o=n.value}catch(e){return void u(e)}if(!n.done)return Promise.resolve(o).then(function(e){step("next",e)},function(e){step("throw",e)});r(o)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var i=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Order,K.default.Component),o(Order,[{"key":"_constructor","value":function _constructor(e){(function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0})(Order.prototype.__proto__||Object.getPrototypeOf(Order.prototype),"_constructor",this).call(this,e),this.$$refs=new K.default.RefsArray}},{"key":"_createData","value":function _createData(e,t,n){var o=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var r=this.$prefix,u=(0,H.genCompid)(r+"$compid__54"),i=W(u,2),a=i[0],c=i[1],s=(0,H.genCompid)(r+"$compid__55"),p=W(s,2),l=p[0],f=p[1],d=(0,H.genCompid)(r+"$compid__56"),y=W(d,2),_=y[0],m=y[1],h=(0,H.genCompid)(r+"$compid__57"),v=W(h,2),b=v[0],O=v[1],g=(0,H.genCompid)(r+"$compid__58"),w=W(g,2),P=w[0],F=w[1],C=this.__props,$=C.orderVisible,x=(C.onClose,C.orderData),k=void 0===x?{}:x,M=(0,H.useState)(!1),R=W(M,2),j=R[0],S=R[1],A=(0,H.useState)(null),D=W(A,2),I=D[0],N=D[1],T=(0,H.useMemo)(function(){return"CN"!==k.countryCode&&K.default.getStorageSync("isSubscribe")},[k]),q=(0,H.useMemo)(function(){var e=k.cname,t=k.carrier,n=k.name,o=k.point,r=k.price,u=k.couponList,i=k.uuid;return{"selection":k.selection,"name":e+" "+t+" 运营商 "+n,"point":T?100*r<=o?100*r-1:o:0,"coupon":T?u&&(u.filter(function(e){return e.uuid===i})[0]||(0===u.length?{}:{"name":u.length+"张可用"})):{}}},[k]);(0,H.useEffect)(function(){N(k.selection)},[k]);var L,E=(0,H.useMemo)(function(){return"point"===I&&q.point?+(q.point/100).toFixed(2):"coupon"===I&&q.coupon.value?+q.coupon.value.toFixed(2):0},[I,k]),V=(0,H.useMemo)(function(){var e=+(k.price-E).toFixed(2);return Number.isNaN(e)?k.price:0<e?e:.01},[I,k]),z=(L=_asyncToGenerator(B.default.mark(function _callee(){var t,n;return B.default.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:if(V<=0)return K.default.showModal({"title":"提示","content":"系统异常，请联系管理官+v：yqq-NO2"}),e.abrupt("return",!0);e.next=3;break;case 3:return e.next=5,Q.orderPay(U({},k,{"pageUrl":encodeURIComponent("https://wechat.globalcharge.cn/home"),"payment":"wc_pay","tradeType":"JSAPI","originalPayAmount":k.price,"payAmount":V,"uuid":q.coupon.uuid,"point":q.point,"selection":T?I:null,"appid":"7487be7c3e180189a492caad3b0d8acd","paySource":"MINI_PROGRAM"}));case 5:return t=e.sent,n=t.result,e.next=9,(0,X.wechatPay)(n.payInfo||{},n.orderCode);case 9:"paySuccess"===e.sent&&o.__props.onClose();case 11:case"end":return e.stop()}},_callee,o)})),function payNow(){return L.apply(this,arguments)}),G=k.price&&k.price.toFixed(2);this.anonymousFunc0=function choosePointRadio(){0!==q.point?N("point"):K.default.showToast({"title":"暂无积分可用","icon":"none","duration":2e3,"mask":!0})};var J=T?q.point&&(q.point/100).toFixed(2):null;return this.anonymousFunc1=function chooseCouponRadio(){k.couponList&&0===k.couponList.length?K.default.showToast({"title":"暂无优惠券可用","icon":"none","duration":2e3,"mask":!0}):(N("coupon"),S(!0))},this.anonymousFunc2=function(){return N(null)},this.anonymousFunc3=z,this.anonymousFunc4=function(){return S(!1)},H.propsManager.set({"className":"myOrder","isOpened":$,"title":"确认付款","onClose":this.__props.onClose},c,a),T&&H.propsManager.set({"value":"check","size":"18","color":"#fff"},f,l),T&&H.propsManager.set({"value":"check","size":"18","color":"#fff"},m,_),T&&H.propsManager.set({"value":"check","size":"18","color":"#fff"},O,b),H.propsManager.set({"couponListVisible":j,"onClose":this.anonymousFunc4},F,P),Object.assign(this.__state,{"anonymousState__temp":G,"anonymousState__temp2":J,"$compid__54":c,"$compid__55":f,"$compid__56":m,"$compid__57":O,"$compid__58":F,"discountVisible":T,"discountRadio":I,"displayOrderData":q,"orderData":k,"discountPrice":E,"payAmount":V}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}},{"key":"anonymousFunc2","value":function anonymousFunc2(){}},{"key":"anonymousFunc3","value":function anonymousFunc3(){}},{"key":"anonymousFunc4","value":function anonymousFunc4(){}}]),u=r=Order,r.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3"],r.$$componentPath="pages/index/components/ProductBar/components/Order/index",u);function Order(){var e,t,n;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Order);for(var o=arguments.length,r=Array(o),u=0;u<o;u++)r[u]=arguments[u];return(t=n=_possibleConstructorReturn(this,(e=Order.__proto__||Object.getPrototypeOf(Order)).call.apply(e,[this].concat(r)))).$usedState=["anonymousState__temp","anonymousState__temp2","$compid__54","$compid__55","$compid__56","$compid__57","$compid__58","discountVisible","discountRadio","displayOrderData","orderData","discountPrice","payAmount","orderVisible"],n.customComponents=["AtFloatLayout","AtIcon","CouponList"],_possibleConstructorReturn(n,t)}t.default=i,Component(n(0).default.createComponent(i))},"52":function(e,t,n){"use strict";n.r(t);var o=n(27),r=n.n(o);for(var u in o)"default"!==u&&function(e){n.d(t,e,function(){return o[e]})}(u);t.default=r.a},"75":function(e,t,n){e.exports=n.p+"pages/index/components/ProductBar/components/Order/index.wxml"}},[[136,0,1,2]]]);